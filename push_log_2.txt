WARN: no SMS provider is enabled. Disabling phone login
Initialising login role...
Connecting to remote database...
Do you want to push these migrations to the remote database?
 â€¢ 20251211114000_create_admin_employee_profile.sql

 [Y/n] Y
Applying migration 20251211114000_create_admin_employee_profile.sql...
ERROR: null value in column "organization_id" of relation "qatar_salary_components" violates not-null constraint (SQLSTATE 23502)                                                                                                    
Failing row contains (1159e761-ef25-4cd4-affa-4d8c28a522f1, null, 16f3e509-d868-468f-9cef-2ea560ed1fa6, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 2025-12-11, null, t, 2025-12-11 06:17:27.207279+00, 2025-12-11 06:17:27.207279+00).
At statement: 0                                                                                                                                                                                                                      
-- Migration to create employee profile for admin user pixelfactory11@gmail.com                                                                                                                                                      
                                                                                                                                                                                                                                     
DO $$                                                                                                                                                                                                                                
DECLARE                                                                                                                                                                                                                              
  v_user_id uuid;                                                                                                                                                                                                                    
  v_org_id uuid;                                                                                                                                                                                                                     
  v_emp_id uuid;                                                                                                                                                                                                                     
  v_email text := 'pixelfactory11@gmail.com';                                                                                                                                                                                        
BEGIN                                                                                                                                                                                                                                
  -- 1. Get User ID                                                                                                                                                                                                                  
  SELECT id INTO v_user_id FROM auth.users WHERE email = v_email;                                                                                                                                                                    
                                                                                                                                                                                                                                     
  IF v_user_id IS NULL THEN                                                                                                                                                                                                          
    RAISE NOTICE 'User % not found', v_email;                                                                                                                                                                                        
    RETURN;                                                                                                                                                                                                                          
  END IF;                                                                                                                                                                                                                            
                                                                                                                                                                                                                                     
  -- 2. Get Organization ID (assuming user is owner or member)                                                                                                                                                                       
  -- Try finding from organization_members first                                                                                                                                                                                     
  SELECT organization_id INTO v_org_id                                                                                                                                                                                               
  FROM organization_members                                                                                                                                                                                                          
  WHERE user_id = v_user_id                                                                                                                                                                                                          
  LIMIT 1;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                     
  -- If not found, try organizations owner                                                                                                                                                                                           
  IF v_org_id IS NULL THEN                                                                                                                                                                                                           
    SELECT id INTO v_org_id FROM organizations WHERE owner_id = v_user_id LIMIT 1;                                                                                                                                                   
  END IF;                                                                                                                                                                                                                            
                                                                                                                                                                                                                                     
  IF v_org_id IS NULL THEN                                                                                                                                                                                                           
    RAISE NOTICE 'Organization not found for user %', v_email;                                                                                                                                                                       
    RETURN;                                                                                                                                                                                                                          
  END IF;                                                                                                                                                                                                                            
                                                                                                                                                                                                                                     
  -- 3. Check if employee exists                                                                                                                                                                                                     
  SELECT id INTO v_emp_id FROM employees WHERE company_email = v_email;                                                                                                                                                              
                                                                                                                                                                                                                                     
  IF v_emp_id IS NULL THEN                                                                                                                                                                                                           
    -- Insert new employee                                                                                                                                                                                                           
    INSERT INTO employees (                                                                                                                                                                                                          
      first_name,                                                                                                                                                                                                                    
      last_name,                                                                                                                                                                                                                     
      company_email,                                                                                                                                                                                                                 
      personal_email,                                                                                                                                                                                                                
      mobile_number,                                                                                                                                                                                                                 
      date_of_joining,                                                                                                                                                                                                               
      employment_type,                                                                                                                                                                                                               
      employment_status,                                                                                                                                                                                                             
      is_active                                                                                                                                                                                                                      
    ) VALUES (                                                                                                                                                                                                                       
      'Pixel',                                                                                                                                                                                                                       
      'Factory',                                                                                                                                                                                                                     
      v_email,                                                                                                                                                                                                                       
      v_email,                                                                                                                                                                                                                       
      '0000000000', -- Placeholder                                                                                                                                                                                                   
      CURRENT_DATE,                                                                                                                                                                                                                  
      'full_time',                                                                                                                                                                                                                   
      'active',                                                                                                                                                                                                                      
      true                                                                                                                                                                                                                           
    ) RETURNING id INTO v_emp_id;                                                                                                                                                                                                    
                                                                                                                                                                                                                                     
    -- If organization_id column exists, update it                                                                                                                                                                                   
    IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name = 'employees' AND column_name = 'organization_id') THEN                                                                                                     
      EXECUTE 'UPDATE employees SET organization_id = $1 WHERE id = $2' USING v_org_id, v_emp_id;                                                                                                                                    
    END IF;                                                                                                                                                                                                                          
                                                                                                                                                                                                                                     
    RAISE NOTICE 'Created employee record %', v_emp_id;                                                                                                                                                                              
  ELSE                                                                                                                                                                                                                               
    RAISE NOTICE 'Employee record already exists: %', v_emp_id;                                                                                                                                                                      
  END IF;                                                                                                                                                                                                                            
                                                                                                                                                                                                                                     
  -- 4. Link to organization_members                                                                                                                                                                                                 
  UPDATE organization_members                                                                                                                                                                                                        
  SET employee_id = v_emp_id                                                                                                                                                                                                         
  WHERE user_id = v_user_id AND organization_id = v_org_id;                                                                                                                                                                          
                                                                                                                                                                                                                                     
  -- 5. Link to user_profiles                                                                                                                                                                                                        
  UPDATE user_profiles                                                                                                                                                                                                               
  SET employee_id = v_emp_id                                                                                                                                                                                                         
  WHERE user_id = v_user_id;                                                                                                                                                                                                         
                                                                                                                                                                                                                                     
END $$                                                                                                                                                                                                                               
Try rerunning the command with --debug to troubleshoot the error.
